# scripts/

This directory contains utility scripts that support setup, media preparation, and validation for running from source.

- `setup_wizard.py` — Guided first-time setup. Creates `.env`, writes `clippy.yaml`, checks binaries, helps you choose a transitions folder, and can generate `run_clippy.ps1` for quick launching. Includes optional Discord setup.
- `health_check.py` — Standalone preflight: verifies ffmpeg/yt-dlp presence, NVENC availability, Python packages, required folders, transitions/static.mp4, fonts, and `.env` credentials.
- `import_media.py` — Normalize or convert any source video/image into a valid transition asset (`intro`, `transition`, `outro`, `static`). Ensures correct codecs, fps, resolution, and loudness.
- `make_transitions.py` — Generate multiple short `transition_XX.mp4` clips by slicing random segments from a long source video.
- `test_transitions.py` — Probe all files in `transitions/`, normalize into `cache/_trans` (48 kHz stereo AAC), and perform an optional audio-only concat validation.
- `check_sequencing.py` — Validate a generated concat list file (e.g., `cache/comp0`) to ensure the sequence policy is obeyed.
- `smoke_local.py` — Local end-to-end smoke test without Twitch. Copies `transitions/static.mp4` to `cache/smoketest/clip.mp4`, runs normalize/overlay, writes a concat file, and performs final concat. Useful to validate Windows quoting and shell invocation.

## Sequencing validator

`check_sequencing.py` expects a concat list file generated by a previous run, typically `cache/comp0` (or `comp1`, …).

Example:

```powershell
# After running a compilation once
python .\scripts\check_sequencing.py --comp .\cache\comp0 --transitions-dir .\transitions
```

If the file doesn’t exist yet, run a small compile first (e.g., `--clips 4 --compilations 1 -y`).

## Setup Wizard

- `setup_wizard.py`: An interactive guided setup that helps you:
  - Enter and save your Twitch Client ID/Secret (writes a `.env`)
  - Choose sensible defaults (clips per compilation, number of compilations, min views)
  - Pick quality preset and tune resolution/fps/audio
  - Configure transitions behavior and audio preferences
  - Set cache/output paths and concurrency
  - Specify a transitions directory via TRANSITIONS_DIR or place assets under transitions/
  - Optional: configure Discord (channel ID, token check); preserves existing settings on re-run
  - Generates a ready-to-run PowerShell helper `run_clippy.ps1`

Usage (PowerShell):

```powershell
python .\scripts\setup_wizard.py
```

Typical usage:

- From source:
  - `python .\scripts\health_check.py`

Notes:
- The checker prefers local `bin/` and `assets/fonts/` paths when running from source.
- Coloring is minimal and safe for Windows consoles.

## Discord usage

See the main README “Discord mode (optional)” section for end-to-end setup and requirements.

## Transitions tools quick reference

When you need to prepare or validate transitions, these tools help you get there fast:

1) Import existing media as transitions

```powershell
# Import a transition clip, converting as needed
python .\scripts\import_media.py path\to\clip.mp4 --type transition

# Create or overwrite the required static.mp4
python .\scripts\import_media.py path\to\image_or_video.mp4 --type static --overwrite

# Name a custom outro file
python .\scripts\import_media.py path\to\outro.mov --type outro --name outro_custom.mp4
```

2) Generate transitions from a long video

```powershell
python .\scripts\make_transitions.py -i .\long_source.mp4 -n 8
```

3) Validate transitions

```powershell
# Normalize all and run audio-only concat check
python .\scripts\test_transitions.py --normalize --concat-audio-check

# Verify a previously generated concat list (e.g., cache\comp0)
python .\scripts\check_sequencing.py --comp .\cache\comp0 --transitions-dir .\transitions
```

## Local smoke test (no Twitch)

Quickly exercise the processing pipeline using only local assets:

```powershell
python .\scripts\smoke_local.py --overlay -y
```

This will:
- Copy `transitions/static.mp4` to `cache/smoketest/clip.mp4`
- Generate a round avatar for overlay (if Pillow available) and run overlay stage
- Normalize, then concatenate into a final file in `cache/`

Set `CLIPPY_DEBUG=1` to print full ffmpeg commands for troubleshooting.
